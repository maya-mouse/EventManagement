<div class="container mx-auto py-8">

    @if (isLoading) {
    <div class="text-center py-20">
        <p class="text-pink-600 text-lg">Datils loading...</p>
    </div>
    } @else if (errorMessage) {
    <div class="text-center py-20 text-red-600 bg-red-100 p-6 rounded-lg">{{ errorMessage }}</div>
    }

    @if (event$ | async; as event) {
    <div class="bg-white p-8 shadow-xl rounded-xl border border-gray-200">

        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6 border-b pb-4">
            <h1 class="text-4xl font-extrabold text-gray-900">{{ event.title }}</h1>

            <div class="flex items-center space-x-3 mt-4 md:mt-0">

                @if (event.isOrganizer) {
                <a [routerLink]="['/events', event.id, 'edit']"
                    class="px-4 py-2 text-md font-semibold text-white bg-blue-600 rounded-lg hover:bg-blue-700 transition duration-150 shadow-md">
                    Edit
                </a>
                <button (click)="onDelete(event.id)"
                    class="px-4 py-2 text-md font-semibold text-white bg-red-600 rounded-lg hover:bg-red-700 transition duration-150 shadow-md">
                    Delete
                </button>
                }

                @else {
                @if (event.isFull) {
                <span
                    class="px-4 py-2 text-md font-semibold text-gray-700 bg-gray-300 rounded-lg cursor-not-allowed shadow-md">Full</span>
                }
                @else if (isLoggedIn && event.isJoined) {
                <button (click)="onLeave(event)"
                    class="px-4 py-2 text-md font-semibold text-white bg-red-500 rounded-lg hover:bg-red-600 transition duration-150 shadow-md">
                    Leave Event
                </button>
                }
                @else if (isLoggedIn) {
                <button (click)="onJoin(event)"
                    class="px-4 py-2 text-md font-semibold text-white bg-pink-600 rounded-lg hover:bg-pink-700 transition duration-150 shadow-md">
                    Join Event
                </button>
                }
                @else {
                <button (click)="router.navigate(['/login'])"
                    class="px-4 py-2 text-md font-semibold text-white bg-green-600 rounded-lg hover:bg-green-700 transition duration-150 shadow-md">
                    Log in to Join
                </button>
                }
                }
            </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">

            <div class="md:col-span-2 space-y-6">
                <h3 class="text-2xl font-semibold text-pink-600 mb-4">Description</h3>
                <p class="text-gray-700 whitespace-pre-wrap">{{ event.description }}</p>

                <div class="pt-4 space-y-3 border-t border-gray-100">
                    <p class="flex items-center text-gray-800 font-medium"><span class="text-gray-400 mr-3 mt-0.5">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 7.5v11.25m-18 0A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75m-18 0v-7.5A2.25 2.25 0 0 1 5.25 9h13.5A2.25 2.25 0 0 1 21 11.25v7.5" />
                            </svg>
                        </span>
                        Date/Time:
                        <span class="ml-2 font-normal">
                            {{ event.dateTime | date:'dd.MM.yyyy' }}, {{ event.dateTime | date:'HH:mm' }}
                        </span>
                    </p>
                    <p class="flex items-center text-gray-800 font-medium"> <span class="text-gray-400 mr-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z" />
                            </svg>
                        </span>
                        Location:
                        <span class="ml-2 font-normal">{{ event.location }}</span>
                    </p>
                    <p class="flex items-center text-gray-800 font-medium">
                        <span class="text-gray-400 mr-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-5">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M15 19.128a9.38 9.38 0 0 0 2.625.372 9.337 9.337 0 0 0 4.121-.952 4.125 4.125 0 0 0-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 0 1 8.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0 1 11.964-3.07M12 6.375a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0Zm8.25 2.25a2.625 2.625 0 1 1-5.25 0 2.625 2.625 0 0 1 5.25 0Z" />
                            </svg>
                        </span> Participants:
                        <span class="ml-2 font-normal">{{ event.participantsCount }}
                            @if (event.capacity !== null) { / {{ event.capacity }} }
                        </span>
                    </p>
                    <p class="flex items-center text-gray-800 font-medium">
                        <span class="text-gray-400 mr-3">
                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                                stroke="currentColor" class="size-6">
                                <path stroke-linecap="round" stroke-linejoin="round"
                                    d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
                            </svg>
                        </span>
                        Organizer:
                        <span class="ml-2 font-normal text-pink-600">{{ event.host.username }}</span>
                    </p>
                </div>
            </div>

            <div class="md:col-span-1 bg-gray-50 p-6 rounded-lg shadow-inner">
                <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b pb-2">Participants ({{
                    event.participantsCount }})</h3>

                @if (event.participants.length > 0) {
                <ul class="space-y-2 max-h-96 overflow-y-auto">
                    @for (participant of event.participants; track participant.userId) {
                    <li class="flex items-center text-sm text-gray-700">
                        <span
                            class="bg-pink-100 text-pink-600 rounded-full w-8 h-8 flex items-center justify-center font-bold mr-3">{{
                            participant.email.charAt(0).toUpperCase() }}</span>

                        {{ participant.username }}
                        @if (participant.userId === event.hostId) {

                        <span
                            class="ml-2 mr-3 px-2 py-0.5 text-xs font-semibold text-white bg-pink-600 rounded-full">ORG</span>
                        @if (event.isOrganizer) {
                        <span class="text-xs text-gray-500 hover:text-pink-600 cursor-pointer">
                            {{ participant.email }}
                        </span>
                        }
                        }

                    </li>
                    }
                </ul>
                } @else {
                <p class="text-gray-500 text-sm">No participants have joined yet</p>
                }
            </div>
        </div>
    </div>
    }
</div>